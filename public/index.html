<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Página de Perfil</title>
  <link rel="stylesheet" href="stylePerfil.css">
  <link href="https://fonts.cdnfonts.com/css/sf-theramin-gothic" rel="stylesheet">
</head>

<body>

  <nav class="sidebar">
    <a href="index.html"> <img src="imagens/perfil.png" alt="Perfil" class="icon"></a>
    <a href="batalha.html"> <img src="imagens/battleEscuro.png" alt="Battle" class="icon"></a>
    <a href="criacao.html"> <img src="imagens/construir.png" alt="Construir" class="icon"></a>
    <a href="campeonato.html"> <img src="imagens/torneio.png" alt="Torneio" class="icon"></a>
  </nav>

  <div class="perfilConteudo">
    <div class="logoContainer">
      <img src="imagens/bladerX.png" alt="BladerX Logo" class="logo">
    </div>

    <div class="cima" id="cima">
      <img src="imagens/fotoPerfil.png" alt="Foto de Perfil" class="fotoPerfil">
    </div>

    <div class="baixo" id="baixo">
      <div class="iconContainer">
        <img src="imagens/colecao.png" alt="Coleção" class="iconPerfil" onclick="colecao()">
        <p class="iconLegenda">Coleção</p>
      </div>

      <div class="iconContainer">
        <img src="imagens/adicionar.png" alt="Adicionar" class="iconPerfil" onclick="adicionar()">
        <p class="iconLegenda">Adicionar</p>
      </div>

      <div class="iconContainer">
        <img src="imagens/historico.png" alt="Histórico" class="iconPerfil" onclick="historico()">
        <p class="iconLegenda">Histórico</p>
      </div>

    </div>

    <div class="superiorEsquerdo" id="superiorEsquerdo">
      <div class="iconContainer">
        <img src="imagens/colecao.png" alt="Coleção" class="iconSuperior" onclick="colecao()">
        <p class="iconLegenda">Coleção</p>
      </div>

    <div class="popup" id="popup">
      <div class="pecasCombo" id="pecasCombo">
      <span class="combos" onclick="combos()">Combos</span>
      <span class="pecas" onclick="carregarPecas()">Peças</span>
    </div>
    <div class='listaPecas' id="listaPecas">
      <h3>Gatinko</h3>
      <div id="gatinko"></div>
    
      <h3>Layer</h3>
      <div id="layer"></div>
    
      <h3>Layer Weight</h3>
      <div id="layerWeight"></div>
    
      <h3>Disk</h3>
      <div id="disk"></div>
    
      <h3>Driver</h3>
      <div id="driver"></div>
    </div>
    </div>
    
      
      <div class="iconContainer">
        <img src="imagens/adicionar.png" alt="Adicionar" class="iconSuperior" onclick="adicionar()">
        <p class="iconLegenda">Adicionar</p>
      </div>

            <div class="addPeca" id="addPeca">
        <label for="nome">Nome:</label>
        <input type="text" id="nome" placeholder="Ex: Achilles">
        
        <label for="abraviacao">Abreviação:</label>
        <input type="text" id="abraviacao" placeholder="Ex: ∀">
        
        <label for="tipo">Tipo:</label>
        <select id="tipo">
          <option value="GatinkoChip">GatinkoChip</option>
          <option value="LayerWeights">LayerWeights</option>
          <option value="LayerBase">LayerBase</option>
          <option value="Disk">Disk</option>
          <option value="Driver">Driver</option>
        </select>
      
        <label for="fkBeyUsuario">fkBeyUsuario:</label>
        <input type="number" id="fkBeyUsuario" placeholder="Ex: 1 (opcional)">
        
        <button onclick="adicionarPeca()">Adicionar Peça</button>
      </div>

      <div class="iconContainer">
        <img src="imagens/historico.png" alt="Histórico" class="iconSuperior" onclick="historico()">
        <p class="iconLegenda">Histórico</p>
      </div>

      
    </div>
</body>

</html>

<script>
//  b-133
// 1	Gatinko Chip - Dragon
// 2	Layer Weight - Zan
// 3	Layer Base - Ace
// 4	Forge Disc - Sting
// 5	Performance Tip - Charge


// b-134
// 1	Gatinko Chip - Valkyrie
// 2	Layer Weight - Retsu
// 3	Layer Base - Slash
// 4	Forge Disc - Blitz
// 5	Performance Tip - Power

// b-134
// 1	Gatinko Chip - Ashura
// 2	Layer Weight - Ten
// 3	Layer Base - Bushin
// 4	Forge Disc - Hurricane
// 5	Performance Tip - Keep

// b-139
// 1	Gatinko Chip - Fafnir
// 2	Layer Weight - Sen
// 3	Layer Base - Wizard
// 4	Forge Disc - Ratchet
// 5	Performance Tip - Rise

  superiorEsquerdo.style.display = 'none'
  popup.style.display = 'none'
  listaPecas.style.display = 'none'
  addPeca.style.display = 'none'

  var imagensPecas = { 
  'Achilles': 'Gatinko/GatinkoChipAchilles.webp', // JSON para colocar um link para cada nome de peça
  'Gou': 'layerWeight/LayerWeightGou.webp',
  'Ace': 'layer/LayerBaseAce.webp',
  'Around': 'disk/DiskAround.webp',
  'Charge': 'driver/DriverCharge.webp',
  'Ashura': 'gatinko/GatinkoChipAshura.webp',
  'Metsu': 'layerWeight/LayerWeightRetsu.webp',
  'Bushin': 'layer/LayerBaseBushin.webp',
  'Ratchet': 'disk/DiskRatchet.webp',
  'Keep': 'driver/DriverKeep.webp',
  'Generate': 'driver/DriverGenerate.webp',
  'Erase': 'layer/LayerBaseErase.webp',
  'Hydra': 'Gatinko/GatinkoChipHydra.webp'
}


  function colecao() {
    alert('colecao')
    superiorEsquerdo.style.display = 'flex'
    popup.style.display = 'block'
    baixo.style.display = 'none'
    cima.style.display = 'none'

  }

  function carregarPecas() {
  pecasCombo.style.display = 'none';
  listaPecas.style.display = 'block';
  addPeca.style.display = 'none'
  

  fetch("/pecas/listar") // Rota que retorna os dados da tabela 'pecas'
    .then(function (response) {
      if (response.ok) {
        return response.json();
      } else {
        console.error("Erro ao buscar peças");
        return [];
      }
    })
    .then(function (pecas) {
      listaPecas.innerHTML = ""; // Limpa a lista antes de carregar

      // Filtrar peças onde fkBeyUsuario é NULL
      var pecasFiltradas = pecas.filter(function (peca) {
        return peca.fkBeyUsuario === null;
      });

      // Obter tipos únicos de peças
      var tipos = [];
      for (var i = 0; i < pecasFiltradas.length; i++) {
        if (tipos.indexOf(pecasFiltradas[i].tipo) === -1) {
          tipos.push(pecasFiltradas[i].tipo);
        }
      }

      // Criar seções para cada tipo
      for (var i = 0; i < tipos.length; i++) {
        var tipo = tipos[i];
        listaPecas.innerHTML +=
          '<div class="tipoPecas">' +
          '<h3>' + tipo + '</h3>' +
          '<div id="tipo-' + tipo + '" class="pecasTipo"></div>' +
          '</div>';
      }

      // Preencher cada tipo com as peças correspondentes
      for (var i = 0; i < pecasFiltradas.length; i++) {
        var peca = pecasFiltradas[i];
        var nomePeca = peca.nome; // Nome da peça
        var tipoPeca = peca.tipo; // Tipo da peça
        var abraviacao = peca.abraviacao; // Abreviação (opcional)
        var imagemCaminho = imagensPecas[nomePeca]; // Caminho da imagem baseado no nome

        // Criando o HTML da peça
        var imgPecas =
          '<div class="imgBey">' +
          '<img src="beyblades/' + imagemCaminho + '" style="width: 50px;" />' +
          '<p>' + nomePeca + ' (' + (abraviacao || "N/A") + ')</p>' +
          '</div>';

        // Adicionando à div correspondente ao tipo
        var tipoContainer = document.getElementById("tipo-" + tipoPeca);
        if (tipoContainer) {
          tipoContainer.innerHTML += imgPecas;
        }
      }
    })
    .catch(function (erro) {
      console.error("Erro na requisição:", erro);
    });
}

function combos() {
  pecasCombo.style.display = 'none';
  listaPecas.style.display = 'block';
  addPeca.style.display = 'none'

  fetch("/pecas/listar") // Rota que retorna os dados da tabela 'pecas'
    .then(function (response) {
      if (response.ok) {
        return response.json();
      } else {
        console.error("Erro ao buscar peças");
        return [];
      }
    })
    .then(function (pecas) {
      listaPecas.innerHTML = ""; // Limpa a lista antes de carregar

      // Agrupar peças por fkBeyUsuario
      var beys = {};
      pecas.forEach(function (peca) {
        if (peca.fkBeyUsuario !== null) {
          if (!beys[peca.fkBeyUsuario]) {
            beys[peca.fkBeyUsuario] = [];
          }
          beys[peca.fkBeyUsuario].push(peca);
        }
      });

      // Exibir combos de peças agrupadas por usuário
      for (var beyId in beys) {
        // Cria um container estilizado para o combo
        var comboContainer = document.createElement('div');
        comboContainer.classList.add('tipoPecas'); // Reutiliza o estilo de tipoPecas

        // Adiciona o título do combo
        comboContainer.innerHTML +=
          '<h3>Combo Beyblade #' + beyId + '</h3>' +
          '<div id="combo-' + beyId + '" class="pecasTipo"></div>';

        listaPecas.appendChild(comboContainer);

        // Preenche as peças do combo
        var pecasCombo = beys[beyId];
        var comboDiv = document.getElementById('combo-' + beyId);

        pecasCombo.forEach(function (peca) {
          var nomePeca = peca.nome; // Nome da peça
          var abraviacao = peca.abraviacao; // Abreviação (opcional)
          var imagemCaminho = imagensPecas[nomePeca]; // Caminho da imagem baseado no nome

          // Criando o HTML da peça
          var imgPecas =
            '<div class="imgBey">' +
            '<img src="beyblades/' + imagemCaminho + '" style="width: 50px;" />' +
            '<p>' + nomePeca + ' (' + (abraviacao || "N/A") + ')</p>' +
            '</div>';

          comboDiv.innerHTML += imgPecas;
        });
      }
    })
    .catch(function (erro) {
      console.error("Erro na requisição:", erro);
    });
}




  function adicionar() {
    alert('adicionar')
    superiorEsquerdo.style.display = 'flex'
    baixo.style.display = 'none'
    popup.style.display = 'none'
    addPeca.style.display = 'block'
    

  }

  function adicionarPeca() {
  // Capturar os valores dos inputs
  var nome = document.getElementById("nome").value;
  var abraviacao = document.getElementById("abraviacao").value;
  var tipo = document.getElementById("tipo").value;
  var fkBeyUsuario = document.getElementById("fkBeyUsuario").value;

  // Validação básica
  if (!nome || !abraviacao || !tipo) {
    alert("Por favor, preencha todos os campos obrigatórios!");
    return;
  }

  // Criar o payload
  var payload = {
    nomeServer: nome,
    abraviacaoServer: abraviacao,
    tipoServer: tipo,
    fkBeyUsuarioServer: fkBeyUsuario || null // Enviar NULL se o campo estiver vazio
  };

  // Enviar o fetch para o backend
  fetch("/pecas/adicionar", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(payload)
  })
    .then(function (response) {
      if (response.ok) {
        alert("Peça adicionada com sucesso!");
        // Opcional: Limpar os campos após o sucesso
        document.getElementById("nome").value = "";
        document.getElementById("abraviacao").value = "";
        document.getElementById("tipo").value = "";
        document.getElementById("fkBeyUsuario").value = "";
      } else {
        console.error("Erro ao adicionar peça");
        alert("Ocorreu um erro ao adicionar a peça.");
      }
    })
    .catch(function (erro) {
      console.error("Erro no fetch:", erro);
      alert("Erro ao conectar com o servidor.");
    });
}

  function historico() {
    alert('historico')
    superiorEsquerdo.style.display = 'flex'
    baixo.style.display = 'none'
    baixo.style.display = 'none'

  }




</script>


